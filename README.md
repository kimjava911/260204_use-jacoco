# Jacoco & GitHub Actions ì»¤ë²„ë¦¬ì§€ ì²´í¬ í”„ë¡œì íŠ¸

ì´ í”„ë¡œì íŠ¸ëŠ” Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ì— **Jacoco**ë¥¼ ì ìš©í•˜ì—¬ ì½”ë“œ ì»¤ë²„ë¦¬ì§€ë¥¼ ì¸¡ì •í•˜ê³ , **GitHub Actions**ë¥¼ í†µí•´ ì»¤ë²„ë¦¬ì§€ ë‹¬ì„±ë¥ ì— ë”°ë¼ ë¹Œë“œ ë° ë°°í¬ë¥¼ ì œì–´í•˜ëŠ” ì˜ˆì œì…ë‹ˆë‹¤.

## ğŸš€ ì£¼ìš” ê¸°ëŠ¥

*   **Spring Boot 3.5.10**: ìµœì‹  Spring Boot ê¸°ë°˜ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜.
*   **Jacoco í†µí•©**: ì½”ë“œ ì»¤ë²„ë¦¬ì§€ ë¶„ì„ ë° ë¦¬í¬íŠ¸ ìƒì„±.
*   **ë™ì  í…ŒìŠ¤íŠ¸ í”„ë¡œíŒŒì¼**: JUnit 5 `@Tag`ë¥¼ í™œìš©í•˜ì—¬ ìƒí™©ë³„(20%, 55%, 80%) í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ êµ¬ì„±.
*   **ì»¤ë²„ë¦¬ì§€ ê²€ì¦**: ì»¤ë²„ë¦¬ì§€ **50% ë¯¸ë§Œ**ì¼ ê²½ìš° ë¹Œë“œ ì‹¤íŒ¨ ì²˜ë¦¬.
*   **GitHub Actions ì›Œí¬í”Œë¡œìš°**:
    *   `workflow_dispatch`ë¥¼ í†µí•œ ìˆ˜ë™ ì‹¤í–‰ (í”„ë¡œíŒŒì¼ ì„ íƒ ê°€ëŠ¥).
    *   í…ŒìŠ¤íŠ¸ -> ì»¤ë²„ë¦¬ì§€ ê²€ì¦ -> ë¹Œë“œ -> Docker ì´ë¯¸ì§€ ìƒì„± -> GHCR ë°°í¬ íŒŒì´í”„ë¼ì¸.
*   **Docker ë©€í‹° ìŠ¤í…Œì´ì§€ ë¹Œë“œ**: Gradle ì´ë¯¸ì§€ë¥¼ ì´ìš©í•œ ë¹Œë“œì™€ JRE ê¸°ë°˜ì˜ ê²½ëŸ‰í™”ëœ ì‹¤í–‰ ì´ë¯¸ì§€ êµ¬ì„±.

---

## ğŸ“Š ì»¤ë²„ë¦¬ì§€ í”„ë¡œíŒŒì¼ (Coverage Profiles)

ì´ í”„ë¡œì íŠ¸ëŠ” í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì‹œ ì‹œìŠ¤í…œ ì†ì„±(`-DcoverageProfile`)ì„ í†µí•´ ì‹¤í–‰í•  í…ŒìŠ¤íŠ¸ ë²”ìœ„ë¥¼ ì¡°ì ˆí•©ë‹ˆë‹¤.

| í”„ë¡œíŒŒì¼ | ì‹¤í–‰ íƒœê·¸ (Tags) | í¬í•¨ ë©”ì†Œë“œ | ì˜ˆìƒ ì»¤ë²„ë¦¬ì§€ | ê²°ê³¼ |
| :--- | :--- | :--- | :--- | :--- |
| **20** | `base` | `add` | **~20%** | âŒ **ì‹¤íŒ¨** (< 50%) |
| **55** | `base`, `medium-add` | `add`, `subtract`, `multiply` | **~60%** | âœ… **í†µê³¼** (>= 50%) |
| **80** | `base`, `medium-add`, `high-add` | `add`, `subtract`, `multiply`, `divide`, `modulus` | **100%** | âœ… **í†µê³¼** |

---

## ğŸ› ï¸ ë¡œì»¬ ë¹Œë“œ ë° í…ŒìŠ¤íŠ¸

ë¡œì»¬ í™˜ê²½ì—ì„œ ê° í”„ë¡œíŒŒì¼ë³„ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ê³  ë¦¬í¬íŠ¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 1. í…ŒìŠ¤íŠ¸ ì‹¤í–‰

```bash
# 20% í”„ë¡œíŒŒì¼ (ë¹Œë“œ ì‹¤íŒ¨ ì˜ˆìƒ)
./gradlew test -DcoverageProfile=20 jacocoTestReport

# 55% í”„ë¡œíŒŒì¼ (ë¹Œë“œ ì„±ê³µ ì˜ˆìƒ)
./gradlew test -DcoverageProfile=55 jacocoTestReport

# 80% í”„ë¡œíŒŒì¼ (ì „ì²´ í…ŒìŠ¤íŠ¸)
./gradlew test -DcoverageProfile=80 jacocoTestReport
```

### 2. ì»¤ë²„ë¦¬ì§€ ê²€ì¦

ì»¤ë²„ë¦¬ì§€ ê¸°ì¤€(50%)ì„ ë§Œì¡±í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

```bash
./gradlew jacocoTestCoverageVerification
```

### 3. ë¦¬í¬íŠ¸ í™•ì¸

í…ŒìŠ¤íŠ¸ ì‹¤í–‰ í›„ ì•„ë˜ ê²½ë¡œì—ì„œ HTML ë¦¬í¬íŠ¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
*   `build/reports/jacoco/test/html/index.html`

---

## ğŸ¤– GitHub Actions ì›Œí¬í”Œë¡œìš°

GitHub Actions íƒ­ì—ì„œ `Jacoco Coverage Check` ì›Œí¬í”Œë¡œìš°ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì‹¤í–‰í•˜ì—¬ CI/CD íŒŒì´í”„ë¼ì¸ì„ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

1.  **Actions** íƒ­ìœ¼ë¡œ ì´ë™.
2.  ì¢Œì¸¡ì˜ **Jacoco Coverage Check** ì„ íƒ.
3.  **Run workflow** ë²„íŠ¼ í´ë¦­.
4.  **Coverage Profile** ì„ íƒ (`20`, `55`, `80`).
5.  **Run workflow** í´ë¦­.

### ì›Œí¬í”Œë¡œìš° ë‹¨ê³„ ìƒì„¸

1.  **Test with Coverage Profile**: ì„ íƒí•œ í”„ë¡œíŒŒì¼ë¡œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë° Jacoco ë¦¬í¬íŠ¸ ìƒì„±.
2.  **Verify Coverage**: ì»¤ë²„ë¦¬ì§€ê°€ 50% ì´ìƒì¸ì§€ ê²€ì¦.
3.  **Build with Gradle**: í…ŒìŠ¤íŠ¸ë¥¼ ì œì™¸í•˜ê³  ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹Œë“œ (`bootJar`).
4.  **Build and push Docker image**: Docker ì´ë¯¸ì§€ ë¹Œë“œ í›„ GitHub Container Registry(GHCR)ì— ë°°í¬.

#### âš ï¸ ì»¤ë²„ë¦¬ì§€ ê²€ì¦ ì‹¤íŒ¨ ì‹œ (ì˜ˆ: Profile 20 ì„ íƒ)

ë§Œì•½ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ê°€ ì„¤ì •ëœ ê¸°ì¤€(**50%**)ì— ë¯¸ì¹˜ì§€ ëª»í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë™ì‘í•©ë‹ˆë‹¤:

*   `Verify Coverage` ë‹¨ê³„ì—ì„œ **ì‹¤íŒ¨(Failure)** ì²˜ë¦¬ë˜ì–´ ì›Œí¬í”Œë¡œìš°ê°€ ì¦‰ì‹œ ì¤‘ë‹¨ë©ë‹ˆë‹¤.
*   ì´í›„ ë‹¨ê³„ì¸ **ë¹Œë“œ(Build)** ë° **Docker ì´ë¯¸ì§€ ë°°í¬(Push)**ëŠ” ì‹¤í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
*   ì´ë¥¼ í†µí•´ í’ˆì§ˆ ê¸°ì¤€ì„ ë§Œì¡±í•˜ì§€ ëª»í•œ ì½”ë“œê°€ ìš´ì˜ í™˜ê²½ì— ë°°í¬ë˜ëŠ” ê²ƒì„ ì›ì²œì ìœ¼ë¡œ ì°¨ë‹¨í•©ë‹ˆë‹¤.

---

## ğŸ³ Docker ë¹Œë“œ ì „ëµ

ì´ í”„ë¡œì íŠ¸ëŠ” **ë©€í‹° ìŠ¤í…Œì´ì§€ ë¹Œë“œ(Multi-stage Build)**ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ìµœì í™”í–ˆìŠµë‹ˆë‹¤.

*   **Builder Stage**: `gradle:jdk17-alpine` ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ ì†ŒìŠ¤ ì½”ë“œë¥¼ ë¹Œë“œí•©ë‹ˆë‹¤.
*   **Runner Stage**: `eclipse-temurin:17-jre-alpine` ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤í–‰ì— í•„ìš”í•œ JAR íŒŒì¼ë§Œ í¬í•¨í•©ë‹ˆë‹¤.

```dockerfile
# 1ë‹¨ê³„: ë¹Œë“œ (Builder)
FROM gradle:jdk17-alpine AS builder
WORKDIR /home/gradle/project
COPY --chown=gradle:gradle . .
RUN gradle bootJar -x test

# 2ë‹¨ê³„: ì‹¤í–‰ (Runner)
FROM eclipse-temurin:17-jre-alpine
VOLUME /tmp
COPY --from=builder /home/gradle/project/build/libs/*.jar app.jar
ENTRYPOINT ["java","-jar","/app.jar"]
```

---

## ğŸ“‚ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
use-jacoco/
â”œâ”€â”€ .github/workflows/
â”‚   â””â”€â”€ jacoco-check.yml    # GitHub Actions ì›Œí¬í”Œë¡œìš° ì„¤ì •
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/java/.../CalculatorService.java      # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚   â””â”€â”€ test/java/.../CalculatorServiceTest.java  # JUnit 5 í…ŒìŠ¤íŠ¸ (Tag ì ìš©)
â”œâ”€â”€ build.gradle            # Gradle ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸ (Jacoco ì„¤ì • í¬í•¨)
â”œâ”€â”€ Dockerfile              # ë©€í‹° ìŠ¤í…Œì´ì§€ Docker ë¹Œë“œ ì„¤ì •
â””â”€â”€ README.md               # í”„ë¡œì íŠ¸ ì„¤ëª…ì„œ
```
